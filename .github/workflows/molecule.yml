name: Test with Molecule
on:
  workflow_call:
    inputs:
      tests_path:
        required: true
        type: string
      base_config_path:
        default: ../../tests/
        required: false
        type: string

jobs:
  molecule:
    runs-on: ubuntu-latest
    strategy:
      fail-fast: true
      matrix:
        scenario:
          - centos7
          - rocky9
    env:
      PY_COLORS: 1
      ANSIBLE_FORCE_COLOR: 1

    steps:
      - name: Run `molecule test`
        uses: UCL-MIRSG/.github/actions/molecule-test@v0.38.0
        with:
          scenario: ${{ matrix.scenario }}
          base_config: format('{0}{1}_base_config.yml', ${{ inputs.base_config_path }}, ${{ matrix.scenario }})
          checkout_path: ansible_collections/mirsg/infrastructure
          tests_path: ${{ inputs.tests_path }}

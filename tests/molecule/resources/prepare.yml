---
- name: Setup for roles
  hosts: all
  gather_facts: true
  tasks:
    - name: Install and configure firewalld
      tags: firewalld
      block:
        - name: Install firewalld
          ansible.builtin.package:
            name: firewalld
            state: present

        - name: Change firewalld backend to iptables
          ansible.builtin.lineinfile:
            path: /etc/firewalld/firewalld.conf
            regexp: "^FirewallBackend="
            line: FirewallBackend=iptables

    - name: Setup for PostgreSQL
      ansible.builtin.include_tasks:
        file: prepare/postgresql.yml
        apply:
          tags:
            - postgresql
      tags:
        - postgresql

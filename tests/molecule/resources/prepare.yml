---
- name: Setup for roles
  hosts: all
  gather_facts: true
  tasks:
    - name: Install and configure firewalld
      tags: firewalld
      block:
        - name: Install firewalld
          ansible.builtin.package:
            name: firewalld
            state: present

        - name: Change firewalld backend to iptables
          ansible.builtin.lineinfile:
            path: /etc/firewalld/firewalld.conf
            regexp: "^FirewallBackend="
            line: FirewallBackend=iptables

    - name: Check the major Python version for the OS
      tags: python
      block:
        - name: Check default version
          ansible.builtin.include_role:
            name: "mirsg.install_python"
            tasks_from: "check_default_version"

        - name: Set install_python variable based on the version to be installed
          ansible.builtin.set_fact:
            install_python: "{{ install_python2 if default_python_version is version('2') else install_python3 }}"

    - name: Setup for PostgreSQL
      tags: postgresql
      block:
        - name: Install crontabs
          ansible.builtin.yum:
            name: cronie
            state: present

        - name: Start crontabs service
          ansible.builtin.service:
            name: crond.service
            state: started
            enabled: true
